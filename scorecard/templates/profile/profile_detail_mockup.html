
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Buffalo City - Profile data - Municipal Money</title>
        <meta name="description" content="Population data from Buffalo City, broken down by category.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="/static/css/vendor/normalize.min.css">
        <link rel="stylesheet" href="/static/css/app.css">
        <link rel="stylesheet" href="/static/css/wazimap.css">
        <link rel="stylesheet" href="/static/stylesheets/scorecard.css">

        <!-- Line Icons Font -->
        <link rel="stylesheet" href="/static/stylesheets/line-icons.css">

<link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
<!--[if lte IE 8]>
    <link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
<![endif]-->
<link href="/static/css/vendor/leaflet.label.css" rel="stylesheet" />


        <script src="//cdn.jsdelivr.net/g/modernizr@2.7,respond@1.4"></script>

        <!-- Begin Google Analytics -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');


            ga('create', 'UA-48399585-37', 'auto');

            ga('send', 'pageview');

        </script>
        <!-- End Google Analytics -->
        <link rel="shortcut icon" href="/static/img/icons/favicon.ico" />
        <link rel="apple-touch-icon-precomposed" href="/static/img/icons/touch-icon-144x144.png" sizes="144x144" />

    <meta property="og:title" content="Municipal Money profile: Buffalo City, Eastern Cape" />
    <meta property="og:site_name" content="Municipal Money" />
    <meta property="og:url" content="http://municipalmoney.org.za" />
    <meta property="og:description" content="Population data from Buffalo City, broken down by category." />
    <meta property="og:type" content="article" />


        <!-- Page generated: 2016-05-11 15:31:14.136510 -->
    </head>
    <body id="profile">

        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->


        <header id="page-header">
            <div id="page-header-title" class="wrapper clearfix">

                <i id="menu-toggle" class="fa fa-bars"></i>

                <a class="title" href="/">
                    <img src="/static/img/wazi-logo.png"> Municipal Money
                </a>


                    <div id="menu" class="tool-set clearfix">
                        <div class="tool-group">
                            <input name="geography_select" id="geography-select" type="text" placeholder="Start typing a place name or address..." autocomplete="off">
                        </div>



                    </div>


                <div class="header-buttons">
                    <a class="wide-only" href="https://twitter.com/" title=" on Twitter"><i class="fa fa-2x fa-twitter"></i></a>


                </div>
            </div>
        </header>
<div id="cover-map" class="clearfix">
    <div id="slippy-map"></div>
    <div id="cover-profile" class="wrapper">
        <article class="clearfix column-half">
            <header id="header-box" class="column-full">
                <h1 class="title">Buffalo City</h1>
                <p class="caption">
                  Municipality in <a href="#">Eastern Cape</a>
                </p>
            </header>
            <div class="stat stat-primary">
              <span class="name">Population</span>
              <span class="value">701,873</span>
            </div>
            <div class="stat stat-secondary">
              <span class="value">2,535.9</span>
              <span class="name"> square kilometres</span>
            </div>
            <div class="stat stat-secondary">
              <span class="value">298.7</span>
              <span class="name"> people per square kilometer</span>
            </div>
        </article>
    </div>
</div>

<div class="page-nav-wrapper">
  <div class="page-nav" data-spy="affix" data-offset-top="281">
    <div class="container">
      <h1 class="title">Buffalo City</h1>
      <ul class="nav nav-tabs">
        <li role="presentation" class="active"><a href="#"><div class="icon icon-office-04"></div>About</a></li>
        <li role="presentation"><a href="#"><div class="icon icon-office-42"></div>Income</a></li>
        <li role="presentation"><a href="#"><div class="icon icon-shopping-03"></div>Spending</a></li>
        <li role="presentation"><a href="#"><div class="icon icon-office-16"></div>Performance</a></li>
      </ul>
    </div>
  </div>
</div>

<!--
<section class="clearfix" id="compare-place-picker">
    <h2>Compare this place with another</h2>
    <div class="typeahead-container">
        <input name="place_select" id="compare-place-select" type="text" placeholder="Start typing a place name or address to compare with..." autocomplete="off">
    </div>
</section>

<p class="explain">Interact with charts and statistics for additional information.</p>
-->

<div class="section" id="about">
  <div class="container">
    <h1>About the Municipality</h1>

    <div class="sub-section" id="who-runs">
      <div class="row">
        <div class="col-md-8 separator-right">
          <h2>Who runs the municipality?</h2>
          
            <div class="row">

              <div class="col-md-6">
                <table class="table table-bordered">
                  <tr>
                    <th colspan="2">Mayor/Executive Mayor</th>
                  </tr>
                  <tr class="text-large">
                    <td class="cell-min"><i class="fa fa-user" aria-hidden="true"></i></td>
                    <td>Mr Alfred Mtsi</td>
                  </tr>
                  <tr class="table-footer">
                    <td colspan="2">+ Show Contact Details</td>
                  </tr>
                </table>
              </div>

              <div class="col-md-6">
                <table class="table table-bordered">
                  <tr>
                    <th colspan="2">Municipal Manager</th>
                  </tr>
                  <tr class="text-large">
                    <td class="cell-min"><i class="fa fa-user" aria-hidden="true"></i></td>
                    <td >Mr Nceba Ncunyana</td>
                  </tr>
                  <tr class="table-footer">
                    <td colspan="2">+ Show Contact Details</td>
                  </tr>
                </table>
              </div>

              <div class="col-md-6">
                <table class="table table-bordered">
                  <tr>
                    <th colspan="2">Deputy Mayor/Executive Mayor</th>
                  </tr>
                  <tr class="text-large">
                    <td class="cell-min"><i class="fa fa-user" aria-hidden="true"></i></td>
                    <td >Mr Xola Pakati</td>
                  </tr>
                  <tr class="table-footer">
                    <td colspan="2">+ Show Contact Details</td>
                  </tr>
                </table>
              </div>

              <div class="col-md-6">
                <table class="table table-bordered">
                  <tr>
                    <th colspan="2">Chief Financial Officer</th>
                  </tr>
                  <tr class="text-large">
                    <td class="cell-min"><i class="fa fa-user" aria-hidden="true"></i></td>
                    <td >Mr Vincent Pillay</td>
                  </tr>
                  <tr class="table-footer">
                    <td colspan="2">+ Show Contact Details</td>
                  </tr>
                </table>
              </div>

            </div>

          <div class="more"><a href="#"><span class="icon"><i class="fa fa-plus" aria-hidden="true"></i></span> Show More</a></div>

        </div>

        <div class="col-md-4">
          <h2>Contact details</h2>
          <table class="table table-bordered">
            <tr>
              <td class="cell-min"><i class="fa fa-phone" aria-hidden="true"></i></td>
              <td><a href="tel:0437052000">043 705 2000</a></td>
            </tr>
            <tr>
              <td class="cell-min"><i class="fa fa-map-marker" aria-hidden="true"></i></td>
              <td><a href="http://www.buffalocity.gov.za">www.buffalocity.gov.za</a></td>
            </tr>
            <tr>
              <td class="cell-min"><i class="fa fa-map-marker" aria-hidden="true"></i></td>
              <td>Trust Bank Centre <br>C/O Oxford & North Street <br>East London <br>5200</td>
            </tr>
          </table>
        </div>
      </div>
    </div>

    <div class="sub-section" id="audit-outcomes">
      <h2>Audit outcomes</h2>
      <div class="row">
        <div class="col-md-8">
          <div class="row">
            <div class="col-md-3">
              <table class="table table-bordered">
                <tr>
                  <td class="text-large text-center"><strong>2015 <br>Unqualified Audit</strong></td>
                </tr>
                <tr class="table-footer">
                  <td><a href="#">Read report</a></td>
                </tr>
              </table>
            </div>
            <div class="col-md-3">
              <table class="table table-bordered">
                <tr>
                  <td class="text-center"><strong>2014 <br>Unqualified Audit</strong></td>
                </tr>
                <tr class="table-footer">
                  <td><a href="#">Read report</a></td>
                </tr>
              </table>
            </div>
            <div class="col-md-3">
              <table class="table table-bordered">
                <tr>
                  <td class="text-center"><strong>2014 <br>Unqualified Audit</strong></td>
                </tr>
                <tr class="table-footer">
                  <td><a href="#">Read report</a></td>
                </tr>
              </table>
            </div>
            <div class="col-md-3">
              <table class="table table-bordered">
                <tr>
                  <td class="text-center"><strong>2014 <br>Unqualified Audit</strong></td>
                </tr>
                <tr class="table-footer">
                  <td><a href="#">Read report</a></td>
                </tr>
              </table>
            </div>
          </div>
          <div class="more"><a href="#"><span class="icon"><i class="fa fa-plus" aria-hidden="true"></i></span> Show More</a></div>
        </div>
        <div class="col-md-4">
          <div class="panel panel-didyouknow">
            <div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i> Did you know?</div>
            <div class="panel-body">
              There are <strong>5 types of audit outcomes</strong>:
              <ul>
                <li>A <strong>clean audit</strong> means that there are no irregularities in the municipality's accounting.</li>
              </ul>
              <div class="more"><a href="#"><span class="icon"><i class="fa fa-plus" aria-hidden="true"></i></span> Show More</a></div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="section" id="income">
  <div class="container">
    <h1>Income</h1>
    <div class="indicator">
      <div class="row">
        <div class="col-md-3">
          <div class="indicator-value indicator-bad">39.3% <i class="fa fa-warning" aria-hidden="true"></i></div>
          <div class="indicator-description">of income billed for has not been collected</div>
          <div class="indicator-average">national average: <strong>47.15%</strong></div>
          <table class="table table-bordered indicator-key">
            <tr>
              <td class="key-symbol indicator-good">good <i class="fa fa-check" aria-hidden="true"></i></td>
              <td class="key-description">less than 15%</td>
            </tr>
            <tr>
              <td class="key-symbol indicator-bad">bad <i class="fa fa-warning" aria-hidden="true"></i></td>
              <td class="key-description">more than 30%</td>
            </tr>
          </table>
        </div>
        <div class="col-md-5">
          [chart]
        </div>
        <div class="col-md-4">
          <div class="panel panel-didyouknow">
            <div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i> Did you know?</div>
            <div class="panel-body">
              A <strong>high value</strong> shows that the municipality is unable to effectively collect the income for the services they've provided.
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="indicator">
      <div class="row">
        <div class="col-md-3">
          <div class="indicator-value indicator-bad">39.3% <i class="fa fa-warning" aria-hidden="true"></i></div>
          <div class="indicator-description">of income billed for has not been collected</div>
          <div class="indicator-average">national average: <strong>47.15%</strong></div>
          <table class="table table-bordered indicator-key">
            <tr>
              <td class="key-symbol indicator-good">good <i class="fa fa-check" aria-hidden="true"></i></td>
              <td class="key-description">less than 15%</td>
            </tr>
            <tr>
              <td class="key-symbol indicator-bad">bad <i class="fa fa-warning" aria-hidden="true"></i></td>
              <td class="key-description">more than 30%</td>
            </tr>
          </table>
        </div>
        <div class="col-md-5">
          [chart]
        </div>
        <div class="col-md-4">
          <div class="panel panel-didyouknow">
            <div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i> Did you know?</div>
            <div class="panel-body">
              A <strong>high value</strong> shows that the municipality is unable to effectively collect the income for the services they've provided.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--
<section>
  <h3>Cash coverage:</h3>
  <ul>
    <li>Result: {2011: 0, 2012: 5.0, 2013: 5.6, 2014: 5.8, 2015: 5.2}</li>
    <li>Formula: Cash available at year end / Operating Expenditure per month</li>
    <li>Cash flow at year end: cube: cflow; item.code: 4200</li>
    <li>Operating Expenditure: cube: incexp, item.code: 4600, amount_type.label: Audited Actual</li>
  </li>

  </ul>

  <h3>Under(Over) spend of operating budget:</h3>
  <ul>
    <li>Result: {2011: 0, 2012: 0, 2013: 0, 2014: 0, 2015: -4.2} %</li>
    <li>Formula: (Budgeted Operating Expenditure - Actual Operating Expenditure) / Budgeted Operating Expenditure</li>
    <li>Budgeted Operating Expenditure: cube: incexp; item.code: 4600; amount_type.label: Adjusted Budget</li>
    <li>Actual Operating Expenditure: cube: incexp, item.code: 4600, amount_type.label: Audited Actual</li>
  </ul>

  <h3>Under(Over) spend of capital budget</h3>
  <ul>
    <li>Result: {2011: 0, 2012: 0, 2013: 0, 2014: 0, 2015: -925.12} %</li>
    <li>Formula: Formula: (Budgeted Capital Expenditure - Actual Capital Expenditure) / Budgeted Capital Expenditure</li>
    <li>Budgeted Capital Expenditure: cube: capital; item.code: 4100; amount_type.label: Adjusted Budget</li>
    <li>Actual Capital Expenditure: cube: capital, item.code: 4100, amount_type.label: Audited Actual</li>
  </ul>

  <h3>Repairs and maintenance as a % of Property, plant and equipment:</h3>
  <ul>
    <li>Result: {2011: 0, 2012: 2.08, 2013: 2.53, 2014: 2.69, 2015: 0.0} %</li>
    <li>Formula: Repairs and maintenance expenditure / (Property, Plant and Equipment + Investment Property)</li>
    <li>Repairs and maintenance expenditure: cube: repmaint; item.code: 5005; amount_type.label: Audited Actual</li>
    <li>Property, Plant and Equipment: cube: bsheet; item.code: 1300; amount_type.label: Audited Actual</li>
    <li>Investment Property: cube: bsheet; item.code: 1401; amount_type.label: Audited Actual</li>
  </ul>

  <h3>Audit opinions:</h3>
  <ul>
    <li>Results: {u&#39;2014&#39;: u&#39;Qualified&#39;, u&#39;2011&#39;: u&#39;Adverse opinion&#39;, u&#39;2013&#39;: u&#39;Qualified&#39;, u&#39;2012&#39;: u&#39;Qualified&#39;}</li>
  </ul>

  <h3>Mayoral staff:</h3>
  Chief Financial Officer
    <ul>
      <li>Name: Mr Vincent Pillay</li>
      <li>Phone: 043 705 1892</li>
      <li>Fax: 043 743 9141</li>
      <li>Email: vincentp@buffalocity.gov.za</li>
    </ul>

    Deputy Mayor/Executive Mayor
    <ul>
      <li>Name: Mr Xola Pakati</li>
      <li>Phone: 043 705 2807</li>
      <li>Fax: 086 545 1288</li>
      <li>Email: philasandep@buffalocity.gov.za</li>
    </ul>

    Mayor/Executive Mayor
    <ul>
      <li>Name: Mr Alfred Mtsi</li>
      <li>Phone: 043 705 1072</li>
      <li>Fax: 043 743 9040</li>
      <li>Email: alfredm@buffalocity.gov.za</li>
    </ul>

    Municipal Manager
    <ul>
      <li>Name: Mr Nceba Ncunyana</li>
      <li>Phone: 043 705 1901</li>
      <li>Fax: 043 743 1941</li>
      <li>Email: ncebaAC@buffalocity.gov.za</li>
    </ul>

    Secretary of Deputy Mayor/Executive Mayor
    <ul>
      <li>Name: Ms Philasande Pula</li>
      <li>Phone: 043 705 2899</li>
      <li>Fax: 086 545 1288</li>
      <li>Email: philasandep@buffalocity.gov.za</li>
    </ul>

    Secretary of Financial Manager
    <ul>
      <li>Name: Ms Candice Bahlmann</li>
      <li>Phone: 043 705 1887</li>
      <li>Fax: 043 743 9141</li>
      <li>Email: candiceb@buffalocity.gov.za</li>
    </ul>

    Secretary of Mayor/Executive Mayor
    <ul>
      <li>Name: Ms Yolisa Ntoni</li>
      <li>Phone: 043 705 1072</li>
      <li>Fax: 043 743 9040</li>
      <li>Email: yolisan@buffalocity.gov.za</li>
    </ul>

    Secretary of Municipal Manager
    <ul>
      <li>Name: Ms Mandisa Mgoqi</li>
      <li>Phone: 043 705 1901</li>
      <li>Fax: 043 743 1941</li>
      <li>Email: mandisamg@buffalocity.gov.za</li>
    </ul>

  <h3>Contact details:</h3>

  <ul>
    <li>Street address 1: Trust Bank Centre</li>
    <li>Street address 2: C/O Oxford &amp; North Street</li>
    <li>Street address 3: East London</li>
    <li>Street address 4: 5200</li>
    <li>Postal address 1: P O BOX 134</li>
    <li>Postal address 2: EAST LONDON</li>
    <li>Postal address 3: 5200</li>
    <li>Phone number: 043 705 2000</li>
    <li>URL: www.buffalocity.gov.za</li>
  </ul>


</section>

-->

        <footer id="page-footer">
            <section class="wrapper footer-container clearfix">

Footer goes here.

            </section>
        </footer>




<script type="text/javascript">




var SITE_NAME = 'Municipal Money';
var SITE_URL = 'http://municipalmoney.org.za';
var EMBED_URL = 'http://municipalmoney.org.za';
var WAZIMAP_COUNTRY_CODE = 'ZA';
var GOOGLE_GEOCODE_API_KEY = '';

var GEOMETRY_URLS = {

};

// standard mapping of summary level code to summary level name
var sumlevMap = {"country": {"sumlev": "country", "plural": "countrys", "children": ["district"], "name": "country"}, "municipality": {"sumlev": "municipality", "ancestors": ["district"], "plural": "municipalities", "name": "municipality", "children": []}, "district": {"sumlev": "district", "ancestors": ["country"], "plural": "districts", "children": ["municipality"], "name": "district"}};

var releaseNames = {};

var MAPIT = {"url": "http://mapit.code4sa.org", "level_codes": {"province": "PR", "country": "CY", "ward": "WD", "municipality": "MN", "district": "DC"}, "level_simplify": {"PR": 0.005, "MN": 0.005, "WD": 0.0001, "DC": 0.01}};

var MAPIT = {"url": "http://mapit.code4sa.org", "level_codes": {"province": "PR", "country": "CY", "ward": "WD", "municipality": "MN", "district": "DC"}, "level_simplify": {"PR": 0.005, "MN": 0.005, "WD": 0.0001, "DC": 0.01}};

</script>



        <!--[if gte IE 9]><!-->
        <script src="//cdn.jsdelivr.net/g/jquery@2.1,d3js@3.4,typeahead.js@0.10.2(typeahead.bundle.min.js),underscorejs@1.6,spinjs@1.3,handlebarsjs@1.3(handlebars.min.js)"></script>
        <!--<![endif]-->

        <!-- local patched version of r2d3 handles percentage widths, HTML overlays -->
        <!--[if lte IE 8]>
        <script src="/static/js/vendor/r2d3.js" charset="utf-8"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/aight/1.2.2/aight.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/aight/1.2.2/aight.d3.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
        <script src="//cdn.jsdelivr.net/g/typeahead.js@0.10.2(typeahead.bundle.min.js),underscorejs@1.6,spinjs@1.3,handlebarsjs@1.3(handlebars.min.js)"></script>
        <![endif]-->

        <!--[if lte IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-ajaxtransport-xdomainrequest/1.0.1/jquery.xdomainrequest.min.js"></script>
        <![endif]-->

        <script src="/static/js/app.js"></script>
        <script src="/static/js/glossary.js"></script>
        <script src="/static/js/widget.geo.select.js"></script>





<script src="//cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
<script src="/static/js/vendor/topojson.v1.min.js"></script>
<script src="/static/js/vendor/leaflet.label.js"></script>
<script src="/static/js/charts.js"></script>
<script src="/static/js/head2head.js"></script>
<script src="/static/js/maps_static.js"></script>
<script src="/static/js/profile_map.js"></script>

<script src="/static/js/maps_mapit.js"></script>
<script src="/static/js/profile_map_mapit.js"></script>

<!-- Bootstrap affix.js & scrollspy.js -->
<script src="/static/js/affix.js"></script>
<script src="/static/js/scrollspy.js"></script>
<script type="text/javascript">
$(document).ready(function(){

});
</script>

<script type="text/javascript">

// Create all the charts
var Charts = {},
    chartContainers = $('[id^=chart-]'),
    defaultDataRelease = '',
    profileData = {"contact_details": {"phone_number": "043 705 2000", "postal_address_1": "P O BOX 134", "postal_address_3": "5200", "postal_address_2": "EAST LONDON", "url": "www.buffalocity.gov.za", "street_address_4": "5200", "street_address_1": "Trust Bank Centre", "street_address_3": "East London", "street_address_2": "C/O Oxford & North Street"}, "mayoral_staff": [{"name": "Vincent Pillay", "title": "Mr", "fax_number": "043 743 9141", "office_phone": "043 705 1892", "role": "Chief Financial Officer", "email": "vincentp@buffalocity.gov.za"}, {"name": "Xola Pakati", "title": "Mr", "fax_number": "086 545 1288", "office_phone": "043 705 2807", "role": "Deputy Mayor/Executive Mayor", "email": "philasandep@buffalocity.gov.za"}, {"name": "Alfred Mtsi", "title": "Mr", "fax_number": "043 743 9040", "office_phone": "043 705 1072", "role": "Mayor/Executive Mayor", "email": "alfredm@buffalocity.gov.za"}, {"name": "Nceba Ncunyana", "title": "Mr", "fax_number": "043 743 1941", "office_phone": "043 705 1901", "role": "Municipal Manager", "email": "ncebaAC@buffalocity.gov.za"}, {"name": "Philasande Pula", "title": "Ms", "fax_number": "086 545 1288", "office_phone": "043 705 2899", "role": "Secretary of Deputy Mayor/Executive Mayor", "email": "philasandep@buffalocity.gov.za"}, {"name": "Candice Bahlmann", "title": "Ms", "fax_number": "043 743 9141", "office_phone": "043 705 1887", "role": "Secretary of Financial Manager", "email": "candiceb@buffalocity.gov.za"}, {"name": "Yolisa Ntoni", "title": "Ms", "fax_number": "043 743 9040", "office_phone": "043 705 1072", "role": "Secretary of Mayor/Executive Mayor", "email": "yolisan@buffalocity.gov.za"}, {"name": "Mandisa Mgoqi", "title": "Ms", "fax_number": "043 743 1941", "office_phone": "043 705 1901", "role": "Secretary of Municipal Manager", "email": "mandisamg@buffalocity.gov.za"}], "audit_opinions": {"2014": "Qualified", "2011": "Adverse opinion", "2013": "Qualified", "2012": "Qualified"}, "rep_maint_perc_ppe": {"2011": 0, "2012": 2.08, "2013": 2.53, "2014": 2.69, "2015": 0.0}, "cap_budget_diff": {"2011": 0, "2012": 0, "2013": 0, "2014": 0, "2015": -925.12}, "cash_coverage": {"2011": 0, "2012": 5.0, "2013": 5.6, "2014": 5.8, "2015": 5.2}, "op_budget_diff": {"2011": 0, "2012": 0, "2013": 0, "2014": 0, "2015": -4.2}, "geography": {"this": {"category": "A", "geo_code": "BUF", "name": "Buffalo City, Eastern Cape", "short_name": "Buffalo City", "parent_geoid": "province-EC", "square_kms": 2535.93, "child_level": null, "geo_level": "municipality", "full_name": "Buffalo City, Eastern Cape", "province_name": "Eastern Cape", "full_geoid": "municipality-BUF", "province_code": "EC"}, "parents": {}}};

var gracefulType = function(chartType) {
    // convert certain chart types to more readable versions at narrow widths
    if (browserWidth <= 640) {
        if (chartType == 'column' || chartType == 'histogram') {
            return 'bar'
        } else if (chartType == 'grouped_column') {
            return 'grouped_bar'
        }
    }
    return chartType
}

var makeCharts = function() {
    $.each(chartContainers, function(i, obj) {
        $(obj).empty();
        var chartID = $(this).prop('id'),
            chartDataKey = chartID.replace('chart-','').replace('alt-',''),
            chartDataID = chartDataKey.split('-'),
            chartType = gracefulType(chartDataID[0]),
            chartData = profileData[chartDataID[1]],
            chartChartTitle = $(this).data('chart-title'),
            chartChartShowYAxis = $(this).data('chart-show-y-axis'),
            chartInitialSort = $(this).data('initial-sort'),
            chartStatType = $(this).data('stat-type'),
            chartDecimalPlaces = $(this).data('decimal-places'),
            chartQualifier = $(this).data('qualifier') || null,
            geographyData = profileData['geography'];

        // allow arbitrary nesting in API data structure
        var drilldown = chartDataID.length - 1;
        if (drilldown >= 2) {
            for (var n = 2; n <= drilldown; n++) {
                chartData = chartData[chartDataID[n]]
            }
        }

        // determine whether data point is from anything other
        // than the primary ACS release for this page
        for (var key in chartData) if (chartData.hasOwnProperty(key)) break;
        var thisRelease = chartData[key]['acs_release'],
            noteRelease = (thisRelease != defaultDataRelease) ? thisRelease + ' data' : null;

        /*chartQualifier = (chartQualifier && noteRelease) ? Array(chartQualifier, noteRelease)
            .filter(function(n) { return n }).join('; ') : null;*/

        var chartstuff = {
            chartContainer: chartID,
            chartDataKey: chartDataKey,
            chartType: chartType,
            chartHeight: 160,
            chartData: chartData,
            chartQualifier: chartQualifier,
            chartChartTitle: chartChartTitle,
            chartInitialSort: chartInitialSort,
            chartStatType: chartStatType,
            chartDecimalPlaces: chartDecimalPlaces,
            geographyData: geographyData
        }
        try {
            Charts[i] = Chart(chartstuff);
        } catch(e) {
            console.log("Error making chart " + chartID)
            console.log(chartstuff);
        }
    });
}

var maps = new ProfileMaps();
maps.drawMapsForProfile(profileData.geography);

makeCharts();

// listen for resize, redraw charts to new dimensions
var lazyRedrawCharts = _.debounce(function() {
    window.browserWidth = document.documentElement.clientWidth;
    window.browserHeight = document.documentElement.clientHeight;
    makeCharts();
}, 50);
$(window).resize(lazyRedrawCharts);

// for touch devices, still allow context toggle
$('.stat-row').on('click', '.stat', function() {
    $(this).find('.context').toggle();
});

var parentLinkContainer = null;
if (!!parentLinkContainer) {
    // set up the listener for trigger to reveal hidden groups
    $('#header-box').on('click', '.link-reveal', function() {
        $(this).hide().next('.hidden').show();
        return false;
    });

    // hit the /parents API endpoint
    $.getJSON(parentGeoAPI)
        .done(function(results) {
            // filter out 'this' from the parents
            var parents = _.reject(results['parents'], function(p) {
                return p.relation === 'this';
            });
            // list of unique parent sumlev types, maintaining order
            var parentRelations = _.uniq(_.pluck(parents, 'sumlevel'));
            // collect parents into individual sumlev groups
            var parentGroups = _.groupBy(parents, function(d) {
                return d.sumlevel;
            });
            // for each parent sumlev type ...
            var parentLinkSets = _.map(parentRelations, function(r) {
                // ... compile a set of links to individual profile pages
                var parentLinkSet = _.map(parentGroups[r], function(v, k) {
                    return '<a href="/profiles/' + v.geoid + '-' + slugify(v.display_name) + '/">' + v.display_name + '</a>';
                });
                var numParents = parentLinkSet.length;
                // if more than one of a sumlev type, group behind reveal link
                if (numParents > 1) {
                    return '<a href="#" class="link-reveal">'+numParents+' '+ sumlevMap[r]['plural'] +'</a><span class="hidden">'+parentLinkSet.join(', ')+'</span>';
                } else {
                    // just one of this sumlev type, so add it to list
                    return parentLinkSet;
                }
            })
            // push the whole thing into the header box ... thingy
            parentLinkContainer.html(parentLinksPrefix + parentLinkSets.join(', '));
            $('body').trigger('glossaryUpdate', parentLinkContainer);
        });
}

</script>

    </body>
</html>
